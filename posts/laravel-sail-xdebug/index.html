<!doctype html><html lang=en><head><title>Laravel Sail - Xdebug Â· @natenatters</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta http-equiv=content-security-policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self'; img-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/; script-src 'self' 'unsafe-inline' https://www.google-analytics.com https://cdn.jsdelivr.net/; prefetch-src 'self'; connect-src 'self' https://www.google-analytics.com;"><meta name=author content="@natenatters"><meta name=description content="Deep dive on Xdebug and using it with Laravel Sail"><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Laravel Sail - Xdebug"><meta name=twitter:description content="Deep dive on Xdebug and using it with Laravel Sail"><meta property="og:title" content="Laravel Sail - Xdebug"><meta property="og:description" content="Deep dive on Xdebug and using it with Laravel Sail"><meta property="og:type" content="article"><meta property="og:url" content="https://natenatters.dev/posts/laravel-sail-xdebug/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-01-22T00:00:00+00:00"><meta property="article:modified_time" content="2023-01-22T00:00:00+00:00"><link rel=canonical href=https://natenatters.dev/posts/laravel-sail-xdebug/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.c4d7e93a158eda5a65b3df343745d2092a0a1e2170feeec909b8a89443903c6a.css integrity="sha256-xNfpOhWO2lpls980N0XSCSoKHiFw/u7JCbiolEOQPGo=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.39e41a7f16bdf8cb16e43cae7d714fa1016f1d2d2898a5b3f27f42c9979204e2.css integrity="sha256-OeQafxa9+MsW5DyufXFPoQFvHS0omKWz8n9CyZeSBOI=" crossorigin=anonymous media=screen><link rel=stylesheet href=/custom.min.85f403ff232218bd8e612424d1885bb4d57fd440764fa75faecb6ceb511c75b4.css integrity="sha256-hfQD/yMiGL2OYSQk0YhbtNV/1EB2T6dfrsts61EcdbQ=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5><meta name=generator content="Hugo 0.110.0"></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>@natenatters</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/posts/>Blog</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://natenatters.dev/posts/laravel-sail-xdebug/>Laravel Sail - Xdebug</a></h1></div></header><div><p>With Sail, you can start debugging your Laravel application in less than 5 minutes!</p><p>But, first lets understand the use cases/ modes:</p><ol><li>Debugging - Stop a script mid execution to inspect variables</li><li>Profiling - Look at slow bottlenecks in a request</li><li>Coverage - Monitor how much code is tested</li></ol><h3 id=what-will-we-learn>What will we learn?
<a class=heading-link href=#what-will-we-learn><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><ul><li>Why modern Xdebug is so easy</li><li>How does Sail do it?</li><li>The Xdebug settings</li><li>Using the debugger in the browser</li><li>Using the profiler</li><li>Using code coverage for tests</li><li><code>xdebug_info()</code></li></ul><h3 id=why-modern-xdebug-is-so-easy>Why modern Xdebug is so easy
<a class=heading-link href=#why-modern-xdebug-is-so-easy><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>The current version, Xdebug 3, has one key difference that makes using it easy:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>export XDEBUG_CONFIG=&#34;client_host=192.168.42.34 log=/tmp/xdebug.log&#34;
</span></span></code></pre></div><p>Instead of using <code>php.ini</code> files, you can configure Xdebug using environment variables.</p><p>This means you can enable the debugger, use it for a few requests, then disable it. All without delving into the server internals, or re-building instances.</p><h3 id=how-does-sail-do-it>How does Sail do it?
<a class=heading-link href=#how-does-sail-do-it><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>Lets have a look at <a href=https://github.com/laravel/sail>laravel/sail</a> on GitHub to see how its taking advantage of this new configuration.</p><p>First, we see a <code>Dockerfile</code> for each supported PHP version. Looking inside <code>runtimes/8.2/Dockerfile</code>, we find:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>apt-get install php8.2-xdebug
</span></span></code></pre></div><p>It is following the <a href=https://xdebug.org/docs/install#linux>instructions provided by Xdebug</a> for installation on a Ubuntu distribution.</p><p>Next, we see the <code>docker-compose.stub</code> has two environment variables:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=font-weight:700>environment</span>:
</span></span><span style=display:flex><span>    <span style=font-weight:700>XDEBUG_MODE</span>: <span style=font-style:italic>&#39;${SAIL_XDEBUG_MODE:-off}&#39;</span>
</span></span><span style=display:flex><span>    <span style=font-weight:700>XDEBUG_CONFIG</span>: <span style=font-style:italic>&#39;${SAIL_XDEBUG_CONFIG:-client_host=host.docker.internal}&#39;</span>
</span></span></code></pre></div><p>These keys and values are &rsquo;nearly&rsquo; identical to the ones Xdebug uses!</p><p>And that&rsquo;s it! Docker Compose passes these environment variables to the Ubuntu container, and Xdebug uses them.</p><p>Well thats not completely it, there&rsquo;s one extra thing&mldr;</p><p>In <code>artisan</code>, theres a command for <code>sail debug ...</code> to activate the debugger:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ARGS+=(exec -u sail -e XDEBUG_SESSION=1)
</span></span></code></pre></div><p>So, again it is following the <a href=https://xdebug.org/docs/step_debug#activate-debugger-cmd>instructions provided by Xdebug</a> for activating the debugger in the command line.</p><h3 id=the-xdebug-settings>The Xdebug settings
<a class=heading-link href=#the-xdebug-settings><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>Only a select set of settings can be set through this <code>XDEBUG_CONFIG</code> variable. Some more useful settings are:</p><ul><li><code>cli_color=0</code></li><li><code>client_host=localhost</code></li><li><code>client_port=9003</code></li><li><code>idekey=*complex*</code></li><li><code>log=/tmp/xdebug.log</code></li><li><code>log_level=7</code></li><li><code>mode=develop</code></li><li><code>output_dir=/tmp</code></li><li><code>profiler_output_name=cachegrind.out.%p</code></li></ul><div class="notice note"><div class=notice-title><i class="fa fa-sticky-note" aria-hidden=true></i>Note</div><div class=notice-content>The <code>mode</code> is set using the <code>XDEBUG_MODE</code> and used like: <code>XDEBUG_MODE=develop,debug</code></div></div><p>To use each setting, you can add them like this:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>XDEBUG_CONFIG=&#34;client_host=192.168.42.34 log=/tmp/xdebug.log&#34;
</span></span></code></pre></div><p>You can find documentation for all of the settings here: <a href=https://xdebug.org/docs/all_settings>https://xdebug.org/docs/all_settings</a></p><h3 id=using-the-debugger-in-the-browser>Using the debugger in the browser
<a class=heading-link href=#using-the-debugger-in-the-browser><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>The debugger is the most documented usage of Xdebug, so I wont write too much. You can see:</p><ul><li><a href=(https://laravel.com/docs/9.x/sail#debugging-with-xdebug)>Laravel documentation</a></li><li><a href="https://www.youtube.com/playlist?list=PLg9Kjjye-m1g_eXpdaifUqLqALLqZqKd4">YouTube playlist</a></li></ul><p>Or, if you use macOS, PHPStorm and Chrome, you can use my setup:</p><ul><li>Add <code>SAIL_XDEBUG_MODE=develop,debug</code> to your <code>.env</code></li><li>Run <code>./vendor/bin/sail up</code></li><li>On the PHPStorm toolbar, toggle <code>Start Listening for PHP Debug Connections</code></li><li>Again, on the toolbar, toggle <code>Break at first line in PHP scripts</code></li><li>Install <code>Chrome Xdebug helper</code> extension</li><li>Visit <a href=http://localhost>http://localhost</a>, with Chrome extension set to Debug</li></ul><h3 id=using-the-profiler>Using the profiler
<a class=heading-link href=#using-the-profiler><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>The profiler allows you to visualise bottlenecks in your PHP code execution, for example slow running functions or high memory usage.</p><p>So, lets set it up:</p><p>First, update your <code>.env</code> variables:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>SAIL_XDEBUG_MODE=profile
</span></span><span style=display:flex><span>SAIL_XDEBUG_CONFIG=&#34;client_host=host.docker.internal output_dir=/var/www/html/storage/app profiler_output_name=cachegrind.out.%R.%u&#34;
</span></span></code></pre></div><div class="notice note"><div class=notice-title><i class="fa fa-sticky-note" aria-hidden=true></i>Note</div><div class=notice-content>I dont use the default <code>profiler_output_name</code>. See <a href=https://stackoverflow.com/questions/73836004/default-profiler-output-name-value>my StackOverflow question</a> for more info. But simply, Clockwork required 1 file per request.</div></div><p>Next, <code>composer require itsgoingd/clockwork --dev</code>, and visit <code>http://localhost/clockwork</code> to start listening for requests to profile!</p><p>Finally, stop/ start Sail and start making web requests to your application!</p><p>Using Clockwork, you can view the call graph for your request.</p><h4 id=webgrind>Webgrind
<a class=heading-link href=#webgrind><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h4><p>If you want a quick&rsquo;n&rsquo;dirty way to visualise your profiles, on macOS I use <a href=https://github.com/jokkedk/webgrind>Webgrind</a> (Because kcachegrind doesnt work on macoS).</p><p>Using the configuration above, you can run:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run --rm -v /path/to/project/storage/app:/tmp -p 2000:80 jokkedk/webgrind:latest
</span></span></code></pre></div><p>Then open <code>http://localhost</code> in your browser load the profile and inspect it!</p><h3 id=using-code-coverage-for-tests>Using code coverage for tests
<a class=heading-link href=#using-code-coverage-for-tests><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>The code coverage allows you to output the amount of code executed during a request. Its useful to see the % code coverage of your test suite.</p><p>This is <a href=https://laravel-news.com/parallel-testing-and-code-coverage>well documented over at Laravel News</a>.</p><p>Or, a tldr;</p><ul><li>Set <code>SAIL_XDEBUG_MODE=coverage</code></li><li>Run <code>php artisan test --coverage</code></li><li>For HTML reports, edit phpunit.xml:</li></ul><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=font-weight:700>&lt;coverage</span> processUncoveredFiles=<span style=font-style:italic>&#34;true&#34;</span><span style=font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=font-weight:700>&lt;include&gt;</span>
</span></span><span style=display:flex><span>        <span style=font-weight:700>&lt;directory</span> suffix=<span style=font-style:italic>&#34;.php&#34;</span><span style=font-weight:700>&gt;</span>./app<span style=font-weight:700>&lt;/directory&gt;</span>
</span></span><span style=display:flex><span>    <span style=font-weight:700>&lt;/include&gt;</span>
</span></span><span style=display:flex><span>    <span style=font-weight:700>&lt;report&gt;</span>
</span></span><span style=display:flex><span>        <span style=font-weight:700>&lt;html</span> outputDirectory=<span style=font-style:italic>&#34;storage/app&#34;</span><span style=font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=font-weight:700>&lt;/report&gt;</span>
</span></span><span style=display:flex><span><span style=font-weight:700>&lt;/coverage&gt;</span>
</span></span></code></pre></div><h3 id=xdebug_info>xdebug_info()
<a class=heading-link href=#xdebug_info><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>With Xdebug 3, we can use <code>xdebug_info()</code> to check what config Xdebug is using.</p><p>If we set <code>SAIL_XDEBUG_MODE=debug</code> in our <code>.env</code> file and stop/ start Sail, you should see a page like the <code>phpinfo()</code> output.</p><p>This is useful for checking your configuration has loaded correctly.</p><h3 id=conclusion>Conclusion
<a class=heading-link href=#conclusion><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>Because Xdebug is way easier to use than it used to be, and the debugger/ profiler are invaluable tools for local development, I think this post adds a lot of value on top of the existing documentation.</p><p>You may be like me, having spent hours in StackOverflow trying to resolve issues with Xdebug and Chrome/ PHPStorm/ Docker.</p><p>But, after reading this article, you can see just how easy it is and start improving your local dev workflow, as well as improving performance bottlenecks before you get to production.</p><h3 id=outro>Outro
<a class=heading-link href=#outro><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><blockquote><p>This blog is to help me remember what I have done, hopefully teach others and get feedback and learn from others.</p></blockquote><blockquote><p>Please let me know if you have tried this, or have any different thoughts on Twitter <a href=https://twitter.com/natenatters/>@natenatters</a>.</p></blockquote></div><footer></footer></article></section></div><footer class=footer><section class=container>Â©
1991 -
2023
@natenatters
Â·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=/js/coder.min.236049395dc3682fb2719640872958e12f1f24067bb09c327b233e6290c7edac.js integrity="sha256-I2BJOV3DaC+ycZZAhylY4S8fJAZ7sJwyeyM+YpDH7aw="></script></body></html>